---
import { markdownify } from "@/lib/utils/textConverter";
import ImageMod from "../ImageMod.astro";
import Button from "@/shortcodes/Button";

const { feature } = Astro.props;
---

<section class="section bg-tertiary">
  <div class="container max-md:px-5">
    {/* Section header */}
    <div class="row">
      <div class="mx-auto mb-12 text-center md:col-10 lg:col-8">
        <p
          set:html={markdownify(feature.subtitle)}
          class="mb-4 text-sm"
          data-aos="fade-up-sm"
        />
        <h2
          set:html={markdownify(feature.title)}
          class="mb-6 lg:h1"
          data-aos="fade-up-sm"
        />
      </div>
    </div>

    {/* Vertical timeline */}
    <div class="relative">
      {/* Timeline connector line (desktop only) */}
      <div class="hidden lg:block absolute left-1/2 top-0 bottom-0 w-px -translate-x-1/2">
        <div class="h-full bg-gradient-to-b from-primary via-primary/40 to-secondary" data-aos="fade-up-sm" />
      </div>

      {/* Steps */}
      <div class="space-y-12 lg:space-y-20">
        {feature.features.map((item: any, index: number) => {
          const isEven = index % 2 === 0;
          return (
            <div class="relative" data-aos="fade-up-sm" data-aos-delay={index * 100}>
              {/* Step number circle on the timeline (desktop) */}
              <div class="hidden lg:flex absolute left-1/2 top-8 -translate-x-1/2 z-10 w-12 h-12 rounded-full bg-gradient-to-br from-primary to-secondary items-center justify-center shadow-lg">
                <span class="text-white font-bold text-lg">{index + 1}</span>
              </div>

              {/* Content card */}
              <div class={`lg:flex items-center gap-8 ${isEven ? '' : 'lg:flex-row-reverse'}`}>
                {/* Text side */}
                <div class={`lg:w-[calc(50%-2rem)] ${isEven ? 'lg:text-right lg:pr-8' : 'lg:text-left lg:pl-8'}`}>
                  <div class={`bg-body rounded-2xl p-6 md:p-8 shadow-sm border border-border/10 ${isEven ? '' : ''}`}>
                    {/* Mobile step number + badge */}
                    <div class={`flex items-center gap-3 mb-4 ${isEven ? 'lg:justify-end' : 'lg:justify-start'}`}>
                      <div class="lg:hidden flex w-10 h-10 rounded-full bg-gradient-to-br from-primary to-secondary items-center justify-center flex-shrink-0">
                        <span class="text-white font-bold">{index + 1}</span>
                      </div>
                      <span
                        set:html={item.badge}
                        class="inline-block border border-primary/20 bg-primary/5 rounded-full px-4 py-1 text-sm font-medium text-primary"
                      />
                    </div>

                    <h3
                      set:html={markdownify(item.content)}
                      class={`mb-3 h4 ${isEven ? 'lg:text-right' : 'lg:text-left'}`}
                    />
                    <p
                      set:html={markdownify(item.description)}
                      class={`mb-6 text-text-dark/70 leading-relaxed ${isEven ? 'lg:text-right' : 'lg:text-left'}`}
                    />
                    {item.button.enable && (
                      <div class={`${isEven ? 'lg:text-right' : 'lg:text-left'}`}>
                        <Button
                          link={item.button.link}
                          label={item.button.label}
                          style="ghost"
                          icon="FaAngleRight"
                          className="text-text-dark hover:text-secondary transition duration-300 p-0"
                        />
                      </div>
                    )}
                  </div>
                </div>

                {/* Image side */}
                <div class={`lg:w-[calc(50%-2rem)] mt-6 lg:mt-0 ${isEven ? 'lg:pl-8' : 'lg:pr-8'}`}>
                  <div class="rounded-2xl overflow-hidden shadow-sm">
                    <ImageMod
                      src={item.image}
                      width={560}
                      height={400}
                      alt={item.title}
                      quality="max"
                      class="object-cover w-full h-[280px] md:h-[340px]"
                    />
                  </div>
                </div>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  </div>
</section>
