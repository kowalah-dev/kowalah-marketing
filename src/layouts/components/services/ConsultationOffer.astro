---
import Button from "@/shortcodes/Button";
import ImageMod from "@/components/ImageMod.astro";
import { markdownify } from "@/lib/utils/textConverter";

interface CTA {
  label: string;
  link: string;
}

interface Offer {
  title: string;
  description: string;
  duration?: string;
  cta: CTA;
}

interface Props {
  title: string;
  subtitle: string;
  description: string;
  primaryCta: CTA;
  offer: Offer;
  backgroundImage?: string;
}

const { title, subtitle, description, primaryCta, offer, backgroundImage }: Props = Astro.props;
const linkClasses = "[&_a]:underline [&_a]:underline-offset-2 [&_a]:transition-colors";
---

<section class={`section ${backgroundImage ? 'relative overflow-hidden' : ''}`}>
  {backgroundImage && (
    <div class="absolute inset-0 -z-10">
      <ImageMod
        src={backgroundImage}
        alt={title}
        width={1920}
        height={800}
        class="w-full h-full object-cover"
      />
      <div class="absolute inset-0 bg-gradient-to-br from-primary/60 via-primary/55 to-secondary/60"></div>
    </div>
  )}

  <div class={`container ${backgroundImage ? 'relative z-10' : ''}`}>
    <div class="row justify-center text-center">
      <div class="col-12 lg:col-8" data-aos="fade-up-sm">
        <h2 class={`h2 mb-4 ${backgroundImage ? 'text-white drop-shadow-lg' : ''}`}>{title}</h2>
        <p class={`text-lg mb-6 ${linkClasses} ${backgroundImage ? 'text-white/95 drop-shadow-md [&_a]:text-white [&_a]:font-medium [&_a]:hover:text-white/80' : 'text-text-dark/80 [&_a]:text-primary [&_a]:hover:text-secondary'}`} set:html={markdownify(subtitle)}></p>
        <p class={`text-base mb-6 ${linkClasses} ${backgroundImage ? 'text-white/90 drop-shadow-md [&_a]:text-white [&_a]:font-medium [&_a]:hover:text-white/80' : 'text-text-dark/80 [&_a]:text-primary [&_a]:hover:text-secondary'}`} set:html={markdownify(description)}></p>
        <Button
          label={primaryCta.label}
          link={primaryCta.link}
          style={backgroundImage ? "light" : "primary"}
          target="_self"
          className="w-full max-w-xs mx-auto"
        />
      </div>
    </div>

    <div class="row justify-center mt-12">
      <div class="col-12 lg:col-8" data-aos="fade-up-sm" data-aos-delay="100">
        <div class={`rounded-3xl border p-8 text-left ${backgroundImage ? 'border-white/30 bg-white/10 backdrop-blur-sm' : 'border-secondary/30 bg-secondary/10'}`}>
          <div class="flex flex-col gap-4 md:flex-row md:justify-between md:items-start">
            <div>
              <p class={`text-xs font-semibold uppercase tracking-[0.35em] mb-2 ${backgroundImage ? 'text-white/70' : 'text-secondary/70'}`}>
                Complimentary Assessment
              </p>
              <h3 class={`text-2xl font-semibold mb-3 ${backgroundImage ? 'text-white' : 'text-text-dark'}`}>{offer.title}</h3>
              <p class={`text-sm mb-4 ${linkClasses} ${backgroundImage ? 'text-white/90 [&_a]:text-white [&_a]:hover:text-white/80' : 'text-text-dark/80 [&_a]:text-primary [&_a]:hover:text-secondary'}`} set:html={markdownify(offer.description)}></p>
              {offer.duration && (
                <p class={`text-sm font-medium ${backgroundImage ? 'text-white' : 'text-secondary'}`}>Duration: {offer.duration}</p>
              )}
            </div>
            <Button
              label={offer.cta.label}
              link={offer.cta.link}
              style={backgroundImage ? "light" : "outline"}
              target="_self"
              className="w-full max-w-xs"
            />
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
