---
description: Validates and imports NDJSON files to Sanity CMS from the marketing copy generation pipeline
---
# Command: Import to Sanity

## Goal

To validate NDJSON import files generated by the copy creation process and facilitate their import into Sanity CMS. This command provides a safety check and clear instructions for the final import step.

## Process

1. **Receive Import File:** The user provides the NDJSON file path here @$ARGUMENTS
2. **Validate File:** Check that the file exists and contains valid NDJSON
3. **Analyze Content:** Parse the file to show what will be imported
4. **Check References:** Ensure all block references in the page document are valid
5. **Show Summary:** Display a clear summary of documents to be created
6. **Provide Import Instructions:** Give the exact command to run for import

## Validation Steps

The AI must perform these checks:

1. **File Validation:**
   - Verify file exists at specified path
   - Confirm it's in `/marketing/imports/` directory
   - Check file extension is `.ndjson`

2. **Content Validation:**
   - Parse each line as valid JSON
   - Verify each document has required fields: `_id`, `_type`
   - Check that block types match known Sanity schemas
   - Ensure page document is present

3. **Schema Validation:**
   - Check all blocks have required `title` field for internal reference
   - Verify URL fields contain full URLs (https://kowalah.com/...) not relative paths
   - For contentSection: ensure uses `contentBlocks` array structure
   - For testimonialSection: check testimonials are references to separate documents
   - For faqSection: check faqs are references to separate documents
   - For ctaBlock: verify urgency/socialProof have `enabled` field structure
   - Validate icon fields are strings from available HeroIcons

4. **Structure Validation:**
   - Ensure most content blocks are embedded inline in pageBuilder array
   - Only testimonial and faq documents should be separate with references
   - Check pageBuilder array contains actual block objects (except testimonials/faqs)
   - Verify testimonial/faq references match separate document IDs

## Output Format

Present the validation results in this format:

```
## Sanity Import Validation Report

**File:** sanity-import-[page-name].ndjson
**Status:** ✅ Valid / ❌ Invalid

### Documents to Import:
- Page Document: [page title] (slug: /[slug])
- Content Blocks:
  1. [Block Type]: [Block Title/Description]
  2. [Block Type]: [Block Title/Description]
  ...

### Validation Results:
✅ All documents have valid structure
✅ Content blocks are embedded inline (not referenced)
✅ All blocks have required title fields
✅ URLs use full format (https://kowalah.com/...)
✅ Special block structures validated (contentSection, testimonials, etc.)

### Import Command (Safe - Draft Documents):
```bash
cd /Users/charliecowan/Kowalah/sanity/kowalah && npx sanity dataset import ../../marketing/imports/[filename].ndjson production --missing
```

### Post-Import Steps:
1. Visit Sanity Studio to verify the draft documents
2. Refine content: add images, adjust copy, review structure
3. Preview draft content using Sanity's preview mode
4. Publish individual documents when ready for production
5. Content remains as drafts until manually published (safe)
```

## Error Handling

If validation fails, provide specific error messages:

- **Invalid JSON:** Show line number and error
- **Missing References:** List which blocks are referenced but not found
- **Schema Mismatch:** Identify fields that don't match schema
- **Missing Required Fields:** List missing fields per document



## Important Notes

**Content Block Structure:**
- Most content blocks must be embedded inline within the page's pageBuilder array
- Only testimonials and FAQs are created as separate documents with references
- The page document should be on a single NDJSON line with embedded blocks

**Example of CORRECT structure:**
```json
{"_id": "drafts.testimonial-john-doe-20250120", "_type": "testimonial", "quote": "...", "author": "John Doe"}
{"_id": "drafts.page-example", "_type": "page", "pageBuilder": [{"_type": "primaryHero", "_key": "hero-section", "title": "Hero - Page Name", "headline": "...", "primaryCta": {"text": "...", "url": "https://kowalah.com/..."}}, {"_type": "testimonialSection", "_key": "testimonials", "title": "Testimonials", "testimonials": [{"_type": "reference", "_ref": "drafts.testimonial-john-doe-20250120"}]}]}
```

**Example of INCORRECT structure (avoid this):**
```json
{"_id": "drafts.hero-123", "_type": "primaryHero", ...}
{"_id": "drafts.page-example", "pageBuilder": [{"_type": "reference", "_ref": "drafts.hero-123"}]}
```

## Final Instructions

1. Read and validate the NDJSON file thoroughly
2. Verify all document IDs have `drafts.` prefix for safety
3. Check content blocks are embedded inline, not referenced
4. Validate all blocks have required `title` fields
5. Ensure URLs are full format with https://kowalah.com prefix
6. Flag any schema validation issues
7. Give exact import command with appropriate flags
8. Emphasize that content will import as drafts (not published)
9. Provide clear post-import refinement workflow
10. Remind about potential validation errors in Sanity Studio